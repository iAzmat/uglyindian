<% content_for :head do %>
    <style type="text/css">
    #map-canvas { height: 100%; width: 100%; margin: 0; padding: 0;}
    </style>
    <script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=true">
    </script>
    <script type="text/javascript">
      function initialize() {
        var infowindow = new google.maps.InfoWindow();
        var points = <%= raw @fixies.to_json %>;
        console.log(points)
        var mapOptions = {
          center: { lat: 12.9715987, lng: 77.5945627 },
          zoom: 14
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        var markers = [];
        console.log(points.length);
        for (var i = 0; i < points.length; i++) {
          console.log(points.length);
          var latLng = new google.maps.LatLng(points[i].latitude,
              points[i].longitude);
          var marker = new google.maps.Marker({'position': latLng, 'info': points[i].info });
          google.maps.event.addListener(marker, 'click', function () {
            infowindow.setContent(this.info);
            infowindow.open(map, this);
          });
          markers.push(marker);
        };
        var markerCluster = new MarkerClusterer(map, markers);
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
<% end %>


<div class='container' style="margin: 10px auto; border: 1px solid #ccc">
    <div class="row" style=""> 
    <h1 style="float: left;"><%= @spotfix.name %></h1>

      <button type="button" class="share btn btn-primary">
          <%= link_to('Share', share_spotfix_path(@spotfix.id), method: :get) %>
      </button>
    <% if @attending %>
      <button type="button" class="join btn btn-success">Attending</button>
    <% else %>    
      <button type="button" class="join btn btn-primary">
          <%= link_to('Join', attendees_path(spotfix_id: @spotfix.id), method: :post) %>
      </button>
    <% end %>
    </div>
    <div class="row" style="min-height: 500px;">
        <div class="col-md-8">
            <p>Location: <%= @spotfix.short_loc %></p>
            <p>To be fixed on: <%= @spotfix.fix_date.strftime("%e %b %Y %H:%M:%S%p") %></p>
            <p>What? <%= @spotfix.description %></p>
            <p>Before:
            <% @spotfix.photos.each do |p| %>
                <%= img_tag p.image %>
            <% end %>
            </p>

        </div>

        <div class="col-md-4" style="min-height: 500px">

          <div id="outer-map" style="width:80%; height: 80%; position: absolute; padding: auto;">
            <div id="map-canvas"></div>
          </div>
        </div>
    </div>
</div>